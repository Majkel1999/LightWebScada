@page "/organizations/{organizationId:int}"

@inject OrganizationContext organizationContext

@attribute [Authorize]

<h2 class="text-center">@m_organizationName</h2>

<div class="container overflow-auto" style="max-width:700px">
    <div class="border" style="padding: 20px; margin: 10px">
        <div class="d-flex justify-content-between">
            <h4>Views</h4>
            <a href="/" class="btn-link">➕ Add view</a>
        </div>
    </div>
</div>

<div class="container overflow-auto" style="max-width:700px">
    <div class="border" style="padding: 20px; margin: 10px">
        <div class="d-flex justify-content-between">
            <h4>Administrators</h4>
            <a href=@String.Concat("/organizations/users/add/",organizationId) class="btn-link">➕ Add
                user/administrator</a>
        </div>
        <table class="table text-center">
            <tbody>
                @foreach (string user in m_members.Where(x => x.isAdmin).Select(x => x.UserName))
                {
                    <tr>
                        <td>@user</td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="d-flex justify-content-between">
            <h4>Users</h4>
        </div>
        <table class="table text-center">
            <tbody>
                @foreach (string user in m_members.Where(x => !x.isAdmin).Select(x => x.UserName))
                {
                    <tr>
                        <td>@user</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="container" style="max-width:700px">
    <div class="border overflow-auto" style="padding:20px;margin:10px">
        <div class="d-flex justify-content-between">
            <h4>Configurations</h4>
            <a href=@String.Concat("/configurations/create/",organizationId) class="btn-link">➕ Add configuration</a>
        </div>
        <table class="table text-center">
            <tbody>
                @foreach (ClientConfigEntity config in m_organizationConfigs)
                {
                    <tr>
                        <td class="text-center">@config.ConfigName</td>
                        <td><a class="oi oi-share-boxed" href=@String.Concat("/configurations/edit/",config.ID)>Edytuj</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<a href=@String.Concat("/organizations/manage/",organizationId)>Manage</a>

@code {
    [Parameter]
    public int organizationId { get; set; }

    private List<ClientConfigEntity> m_organizationConfigs;
    private List<OrganizationMember> m_members;
    private string m_organizationName;

    protected override Task OnInitializedAsync()
    {
        InitParams();
        return base.OnInitializedAsync();
    }

    protected override Task OnParametersSetAsync()
    {
        InitParams();
        return base.OnParametersSetAsync();
    }

    private void InitParams()
    {
        m_organizationName = organizationContext.Organizations
        .Where(x => x.OrganizationId == organizationId)
        .Select(x => x.Name)
        .FirstOrDefault();
        m_organizationConfigs = organizationContext.Configurations
        .Where(x => x.OrganizationId == organizationId).ToList();
        m_members = organizationContext.Members
        .Where(x => x.OrganizationId == organizationId)
        .ToList();
    }
}