@page "/register"
@using FrontEnd.DataModels
@using FrontEnd.Access
@inject NavigationManager NavManager

<div class="container" style="max-width:500px">
    <div class="text-center font-weight-bolder" style="font-size:32px">Rejestracja</div>

    <div class="border" style="padding:20px">
        <EditForm Model="@userRegistration" OnValidSubmit="@Submit">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="form-group">
                <label for="email"><b>Nazwa użytkownika</b></label>
                <InputText id="username" @bind-Value="userRegistration.Username" class="form-control" required
                    placeholder="Nazwa użytkownika..." />
            </div>
            <div class="form-group">
                <label for="email"><b>Adres e-mail</b></label>
                <InputText id="email" @bind-Value="userRegistration.Email" class="form-control" required
                    placeholder="Adres e-mail..." />
            </div>
            <div class="form-group">
                <label for="email"><b>Hasło</b></label>

                <InputText type="password" id="pw" @bind-Value="userRegistration.Password" class="form-control" required
                    placeholder="Hasło..." />
            </div>
            <div class="form-group">
                <label for="email"><b>Powtórz hasło</b></label>
                <InputText type="password" id="pw2" @bind-Value="userRegistration.ConfirmPassword" class="form-control"
                    required placeholder="Hasło..." />
            </div>

            <button class="btn btn-primary" type="submit">Załóż konto</button>
            <a class="btn btn-danger" type="button" href="/">Anuluj</a>
        </EditForm>
    </div>
</div>

@code {
    public UserRegistration userRegistration { get; set; } = new UserRegistration();

    public void Submit()
    {
        if (UserCredentialHelper.IsUsernameTaken(userRegistration.Username))
        {
            NavManager.NavigateTo("/");
        }
        else
        {
            UserCredentialHelper.RegisterUser(userRegistration);
            NavManager.NavigateTo("/register/success");
        }
    }
}
