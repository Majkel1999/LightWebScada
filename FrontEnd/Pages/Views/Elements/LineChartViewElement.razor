<div class="round-border flex-center">
    <div class="center-text">
        <RadzenChart @ref="m_chart">
            <RadzenLineSeries Data=@m_chartData ValueProperty="Value" CategoryProperty="Date" Title="Value">
                <RadzenMarkers MarkerType="MarkerType.Circle" />
            </RadzenLineSeries>
            <RadzenCategoryAxis Padding="20" FormatString="{0:HH:mm:ss}" />
            <RadzenValueAxis>
                <RadzenGridLines Visible="true" />
            </RadzenValueAxis>
        </RadzenChart>
    </div>
</div>

@code {
    private const int MaximumPoints = 50;

    [Parameter]
    public ViewElement View { get; set; }
    [Parameter]
    public bool FirstPass { get; set; }

    public List<ChartItem> m_chartData { get; set; } = new List<ChartItem>();

    private RadzenChart m_chart { get; set; }

    public override async Task SetParametersAsync(ParameterView parameters)
    {
        await base.SetParametersAsync(parameters);
        if (View.InitialData != null && m_chartData.Count < MaximumPoints)
        {
            foreach (RegisterFrame frame in View.InitialData)
                m_chartData.Add(new ChartItem(frame.Value, frame.Timestamp.ToLocalTime()));
        }
    }

    protected override void OnParametersSet()
    {
        int? value = View.GetValue();
        if (!FirstPass && value.HasValue)
            m_chartData.Add(new ChartItem(value.Value, View.TimeStamp));

        if (m_chartData.Count > MaximumPoints)
            m_chartData.RemoveRange(0, m_chartData.Count - MaximumPoints);

        m_chartData = m_chartData.ToList();
        m_chart?.Reload();
        StateHasChanged();
    }
}